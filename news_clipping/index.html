<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>êµ¬ê¸€ë‰´ìŠ¤ í´ë¦¬í•‘ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8f9fa; }
        .dashboard-title { font-size: 2.5rem; font-weight: bold; margin-top: 2rem; }
        .category-card { min-width: 320px; margin-bottom: 2rem; }
        .news-title { font-weight: 500; }
        .news-date { font-size: 0.9rem; color: #888; }
        .count-badge { font-size: 1.1rem; margin-left: 0.5rem; }
        .card-body { max-height: 600px; overflow-y: auto; }
        .row.justify-content-center { display: flex; flex-wrap: nowrap; justify-content: center; }
        .col-md-4 { flex: 0 0 33.3333%; max-width: 33.3333%; }
        .update-btn { position: absolute; right: 10.5rem; top: 2.2rem; }
        .export-btn { position: absolute; right: 2rem; top: 2.2rem; }
    </style>
</head>
<body>
<div class="container position-relative">
    <div class="text-center dashboard-title">êµ¬ê¸€ë‰´ìŠ¤ í´ë¦¬í•‘ ëŒ€ì‹œë³´ë“œ</div>
    <a href="https://github.com/allipceo/GI_Agent/actions/workflows/update-news.yml" target="_blank" class="btn btn-outline-primary update-btn" title="í´ë¦­ ì‹œ ì—…ë°ì´íŠ¸ ì‹¤í–‰ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.">
        ğŸ”„ ìµœì‹  ë‰´ìŠ¤ë¡œ ìˆ˜ë™ ì—…ë°ì´íŠ¸
    </a>
    <button class="btn btn-secondary export-btn" onclick="showExportModal()">ë‚´ë³´ë‚´ê¸°</button>
    <div class="text-center mb-4" id="update-time">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: -</div>
    <div class="text-center mb-4" style="font-size: 0.9rem; color: #6c757d;">
        <strong>ì—…ë°ì´íŠ¸ ë°©ë²•:</strong> ë²„íŠ¼ í´ë¦­ â†’ 'Run workflow' ì‹¤í–‰ â†’ 1-2ë¶„ í›„ ì´ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
    </div>
    <div class="row justify-content-center">
        <div class="col-md-4">
            <div class="card category-card border-info">
                <div class="card-header bg-info text-white">ë³´í—˜ì¤‘ê°œ <span class="count-badge" id="count-ë³´í—˜ì¤‘ê°œ">(0ê±´)</span></div>
                <div class="card-body" id="news-cards-ë³´í—˜ì¤‘ê°œ"></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card category-card border-success">
                <div class="card-header bg-success text-white">ì‹ ì¬ìƒì—ë„ˆì§€ <span class="count-badge" id="count-ì‹ ì¬ìƒì—ë„ˆì§€">(0ê±´)</span></div>
                <div class="card-body" id="news-cards-ì‹ ì¬ìƒì—ë„ˆì§€"></div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card category-card border-warning">
                <div class="card-header bg-warning text-white">ë°©ì‚° <span class="count-badge" id="count-ë°©ì‚°">(0ê±´)</span></div>
                <div class="card-body" id="news-cards-ë°©ì‚°"></div>
            </div>
        </div>
    </div>
    <div class="text-center mt-4 mb-5">
        <strong id="total-count">ì´ ìˆ˜ì§‘: -ê±´</strong>
    </div>
</div>
<!-- ë‚´ë³´ë‚´ê¸° ëª¨ë‹¬ -->
<div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exportModalLabel">ë‰´ìŠ¤ ë‚´ë³´ë‚´ê¸°</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="export-keyword-select" class="form-label">í‚¤ì›Œë“œ</label>
          <select id="export-keyword-select" class="form-select" onchange="toggleCustomKeywordInput()">
            <option value="all">ì „ì²´</option>
            <option value="ë³´í—˜ì¤‘ê°œ">ë³´í—˜ì¤‘ê°œ</option>
            <option value="ì‹ ì¬ìƒì—ë„ˆì§€">ì‹ ì¬ìƒì—ë„ˆì§€</option>
            <option value="ë°©ì‚°">ë°©ì‚°</option>
            <option value="custom">ì‚¬ìš©ì í‚¤ì›Œë“œ ì§ì ‘ ì…ë ¥</option>
          </select>
          <input type="text" id="export-keyword-input" class="form-control mt-2" placeholder="í‚¤ì›Œë“œ ì…ë ¥" style="display:none;">
        </div>
        <div class="mb-3">
          <label for="export-format" class="form-label">í¬ë§·</label>
          <select id="export-format" class="form-select">
            <option value="csv">CSV</option>
            <option value="xlsx">ì—‘ì…€(xlsx)</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" onclick="exportNews()">ë‹¤ìš´ë¡œë“œ</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script>
const KEYWORDS = ["ë³´í—˜ì¤‘ê°œ", "ì‹ ì¬ìƒì—ë„ˆì§€", "ë°©ì‚°"];
let newsData = [];
let exportModal;

document.addEventListener('DOMContentLoaded', () => {
    fetchNewsData();
    exportModal = new bootstrap.Modal(document.getElementById('exportModal'));
});

function renderCards(keyword) {
    const container = document.getElementById(`news-cards-${keyword}`);
    container.innerHTML = '';
    const filtered = newsData.filter(item => item.keyword === keyword);
    document.getElementById(`count-${keyword}`).innerText = `(${filtered.length}ê±´)`;
    if (filtered.length === 0) {
        container.innerHTML = '<div class="col"><p class="text-muted">ìˆ˜ì§‘ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
        return;
    }
    filtered.forEach(item => {
        const card = document.createElement('div');
        card.className = 'mb-3';
        card.innerHTML = `
            <div class="card border-secondary">
                <div class="card-header">${item.source || 'ì–¸ë¡ ì‚¬ ë¯¸ìƒ'}</div>
                <div class="card-body">
                    <div class="news-title"><a href="${item.link}" target="_blank">${item.title}</a></div>
                    <div class="news-date">${item.date}</div>
                </div>
            </div>
        `;
        container.appendChild(card);
    });
}

function updateTime() {
    if (newsData.length === 0) return;
    // ìµœì‹  ë‰´ìŠ¤ì˜ date ê¸°ì¤€
    const dates = newsData.map(n => new Date(n.date)).filter(d => !isNaN(d));
    if (dates.length === 0) return;
    const latest = new Date(Math.max(...dates));
    const formatted = latest.toLocaleString('ko-KR', { hour12: false });
    document.getElementById('update-time').innerText = `ë°ì´í„° ë¡œë“œ ì‹œì : ${formatted}`;
}

function fetchNewsData() {
    fetch('news_data.json')
        .then(res => res.json())
        .then(data => {
            newsData = data;
            KEYWORDS.forEach(renderCards);
            updateTime();
            document.getElementById('total-count').innerText = `ì´ ìˆ˜ì§‘: ${newsData.length}ê±´`;
        })
        .catch(() => {
            alert('news_data.json íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        });
}

function showExportModal() {
    exportModal.show();
}

function exportNews() {
    const keyword = document.getElementById('export-keyword').value.trim();
    const format = document.getElementById('export-format').value;
    let filtered = newsData;
    if (keyword) {
        filtered = newsData.filter(item =>
            item.title.includes(keyword) ||
            item.keyword.includes(keyword) ||
            item.source.includes(keyword)
        );
    }
    if (filtered.length === 0) {
        alert('í•´ë‹¹ í‚¤ì›Œë“œì— í•´ë‹¹í•˜ëŠ” ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    // íŒŒì¼ëª… ì§€ì •
    const filename = keyword ? `í‚¤ì›Œë“œ_${keyword}.${format}` : `news_export.${format}`;
    if (format === 'csv') {
        let csv = 'date,title,link,keyword,source\n';
        filtered.forEach(item => {
            csv += `"${item.date}","${item.title.replace(/"/g, '""')}","${item.link}","${item.keyword}","${item.source}"\n`;
        });
        const blob = new Blob([csv], {type: 'text/csv'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    } else if (format === 'xlsx') {
        const ws = XLSX.utils.json_to_sheet(filtered);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'ë‰´ìŠ¤');
        XLSX.writeFile(wb, filename);
    }
    exportModal.hide();
}
</script>
</body>
</html> 